apply plugin: 'antlr'
apply plugin: 'org.jetbrains.kotlin.jvm'
apply plugin: "com.github.johnrengelman.shadow"
apply plugin: "application"

import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar

mainClassName = "info.spiralframework.console.Cockpit"

//shadowJar {
//    mergeServiceFiles()
//    baseName = jar.baseName
//    appendix = jar.appendix
//    version = jar.version
//
//    classifier = "shadow"
//}

dependencies {
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.0-RC'
    implementation "ch.qos.logback:logback-classic:$logback_version"

    implementation project(":core")
    implementation project(":updater")

    antlr "org.antlr:antlr4:4.7.2"
}

jar {
    archiveBaseName.set("spiral-$project.name")
    archiveVersion.set(project_version)
}

task shadowJar(type: ShadowJar, dependsOn: [jar], overwrite: true) {
    mergeServiceFiles()
    from jar.archiveFile
    configurations = [project.configurations.runtimeClasspath]
    manifest {
        attributes 'Main-Class': mainClassName
    }
    
    group = "shadow"

    archiveBaseName.set(jar.archiveBaseName.get())
    archiveAppendix.set(jar.archiveAppendix.getOrNull())
    archiveVersion.set(jar.archiveVersion.get())
    archiveClassifier.set("shadow")
}

generateGrammarSource {
    arguments += ['-visitor', '-package', 'info.spiralframework.antlr.pipeline']
    outputDirectory = file("$buildDir/generated-src/antlr/main/info/spiralframework/antlr/pipeline")
}

//publishing {
//    publications {
//        maven(MavenPublication) {
//            artifact shadowJar
//        }
//    }
//}